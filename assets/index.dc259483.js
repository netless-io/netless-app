import{m,y,e as t,_ as P,A as S,d as X,S as U}from"./hooks.module.ea4857d9.js";import{g as I}from"./compat.module.eeb6ada8.js";import{c as z}from"./index.dc048eb9.js";const _=`.time-cell{display:flex;flex-flow:column nowrap;align-items:center;font-family:sans-serif;font-weight:700}.time-cell.disabled .time-cell-up:before,.time-cell.disabled .time-cell-down:after{border-top-color:#0000000d;border-bottom-color:#0000000d}.time-cell-up:before,.time-cell-down:after{content:"";display:block;width:0;height:0;margin:0 0 4px;border-top:0;border-left:12px solid transparent;border-right:12px solid transparent;border-bottom:12px solid #151515;transition:border-color .4s;cursor:pointer}.time-cell-down:after{margin:4px 0 0;border-top:12px solid #151515;border-bottom:0}.rotor{position:relative;width:36px;height:64px;border-radius:4px;font-size:48px;text-align:center;perspective:200px}.rotor-top,.rotor-bottom{overflow:hidden;position:absolute;width:36px;height:32px}.rotor-leaf{z-index:1;position:absolute;width:36px;height:64px;transform-style:preserve-3d;transition:transform 0s}.rotor-leaf.flipped{transform:rotateX(-180deg);transition:all .5s ease-in-out}.rotor-leaf-front,.rotor-leaf-rear{overflow:hidden;position:absolute;width:36px;height:32px;margin:0;transform:rotateX(0);backface-visibility:hidden;-webkit-backface-visibility:hidden}.rotor-leaf-front{line-height:64px;border-radius:4px 4px 0 0}.rotor-leaf-rear{line-height:0px;border-radius:0 0 4px 4px;transform:rotateX(-180deg)}.rotor-top{line-height:64px;border-radius:4px 4px 0 0}.rotor-bottom{bottom:0;line-height:0px;border-radius:0 0 4px 4px}.rotor:after{content:"";z-index:2;position:absolute;bottom:0px;left:0px;width:36px;height:32px;border-radius:0 0 4px 4px}.rotor,.rotor-top,.rotor-leaf-front{color:#fff;background-color:#151515}.rotor-bottom,.rotor-leaf-rear{color:#efefef;background-color:#202020}.rotor:after{border-top:solid 1px #151515}.telebox-color-scheme-dark .time-cell.disabled .time-cell-up:before,.telebox-color-scheme-dark .time-cell.disabled .time-cell-down:after{border-top-color:#ffffff14;border-bottom-color:#ffffff14}.telebox-color-scheme-dark .time-cell-up:before,.telebox-color-scheme-dark .time-cell-down:after{border-top-color:#d9d9df;border-bottom-color:#d9d9df}.telebox-color-scheme-dark .rotor,.telebox-color-scheme-dark .rotor-top,.telebox-color-scheme-dark .rotor-leaf-front{color:#383838;background-color:#efeff5}.telebox-color-scheme-dark .rotor-bottom,.telebox-color-scheme-dark .rotor-leaf-rear{color:#333;background-color:#eeecec}.telebox-color-scheme-dark .rotor:after{border-top:solid 1px #efeff5}.countdown-clock{display:flex;padding:5px}.countdown-clock>*{padding:0 5px}.countdown-clock-divider{display:flex;flex-direction:column;justify-content:center;align-items:center;padding:0 1px}.countdown-clock-divider:before,.countdown-clock-divider:after{content:"";display:block;width:8px;height:8px;margin:6px 0;background-color:#000;border-radius:50%}.netless-app-countdown{width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;transition:background-color .4s}.netless-app-countdown-shrink{display:inline-block;transition:background-color .4s}.netless-app-countdown-btns{width:100%;margin-top:10px;display:flex;flex-wrap:nowrap}.netless-app-countdown-btns>button{flex:1;display:block;margin:0 10px 0 0;padding:5px 10px;text-align:center;border:0;border-radius:4px;color:#fff;background-color:#3380ff;transition:background-color .4s,color .4s;cursor:pointer}.netless-app-countdown-btns>button:last-of-type{margin:0}.netless-app-countdown-btns>button:disabled{color:#00000040;background:#f5f5f5;cursor:not-allowed}.telebox-color-scheme-dark .netless-app-countdown-btns>button:disabled{color:#ffffff4d;background:rgba(255,255,255,.08)}
`;const N=I(({digit:e,disabled:o,onUp:r,onDown:n})=>{const[c,l]=m(0),[d,a]=m(!1);return y(()=>{if(o){a(!0);const s=window.setTimeout(()=>{a(!1),l(e)},500);return()=>window.clearTimeout(s)}else l(e)},[e]),t("div",{class:z("time-cell",{disabled:o}),children:[t("div",{class:"time-cell-up",onClick:o?void 0:r}),t("div",{class:"rotor",children:[t("div",{class:z("rotor-leaf",{flipped:d}),children:[t("figure",{class:"rotor-leaf-rear",children:e}),t("figure",{class:"rotor-leaf-front",children:c})]}),t("div",{class:"rotor-top",children:e}),t("div",{class:"rotor-bottom",children:c})]}),t("div",{class:"time-cell-down",onClick:o?void 0:n})]})});var f=(e=>(e[e.AddTenMinutes=0]="AddTenMinutes",e[e.ReduceTenMinutes=1]="ReduceTenMinutes",e[e.AddOneMinute=2]="AddOneMinute",e[e.ReduceOneMinute=3]="ReduceOneMinute",e[e.AddTenSeconds=4]="AddTenSeconds",e[e.ReduceTenSeconds=5]="ReduceTenSeconds",e[e.AddOneSecond=6]="AddOneSecond",e[e.ReduceOneSecond=7]="ReduceOneSecond",e))(f||{});function H(e){return P(()=>(e=e%61,[Math.floor(e/10),e%10]),[e])}function b(e,o){return S(()=>e(o),[e])}const $=I(({minutes:e,seconds:o,disabled:r,onAdjustTime:n})=>{const c=H(e),l=H(o),d=b(n,0),a=b(n,1),s=b(n,2),i=b(n,3),g=b(n,4),h=b(n,5),w=b(n,6),k=b(n,7);return t("div",{className:"countdown-clock",children:[t(N,{disabled:r,digit:c[0],onUp:d,onDown:a}),t(N,{digit:c[1],disabled:r,onUp:s,onDown:i}),t("div",{class:"countdown-clock-divider"}),t(N,{disabled:r,digit:l[0],onUp:g,onDown:h}),t(N,{digit:l[1],disabled:r,onUp:w,onDown:k})]})}),q=I(({readonly:e,countdownSecs:o,startTime:r,paused:n,onAdjustTime:c,onStart:l,onPause:d,onResume:a,onReset:s})=>{const[i,g]=m(0),h=r>0&&i>=r,w=o-(h?i-r:0),k=Math.floor(w/60),F=w-k*60;return y(()=>{let O=NaN;if(o>0&&r>0&&!n){const M=()=>{g(Math.floor(Date.now()/1e3)),O=window.requestAnimationFrame(M)};return M(),()=>window.cancelAnimationFrame(O)}else window.cancelAnimationFrame(O)},[r,n,o]),y(()=>{r>0&&i-r>=o&&s()},[i,r,o,s]),t("div",{class:"netless-app-countdown",children:t("div",{class:"netless-app-countdown-shrink",children:[t($,{minutes:k,seconds:F,disabled:e||h,onAdjustTime:c}),t("div",{class:"netless-app-countdown-btns",children:n?t(X,{children:[t("button",{onClick:s,disabled:e,children:"Reset"}),t("button",{onClick:a,disabled:e,children:"Resume"})]}):h?t("button",{onClick:d,disabled:e,children:"Pause"}):t("button",{onClick:l,disabled:e||w<=0,children:"Start"})})]})})}),E=I(({context:e,storage:o})=>{const[r,n]=m(()=>e.isWritable),[c,l]=m(o.state.countdownSecs),[d,a]=m(o.state.startTime),[s,i]=m(o.state.paused),g=d>0,h=S(()=>{e.isWritable&&(i(!1),a(Math.floor(Date.now()/1e3)))},[e]),w=S(()=>{e.isWritable&&i(!0)},[e]),k=S(()=>{e.isWritable&&i(!1)},[e]),F=S(()=>{e.isWritable&&(i(!1),l(0),a(0))},[e]),O=S(M=>{g||l(p=>{if(!e.isWritable)return p;const x=Math.floor(p/60),u=p-x*60,C=Math.floor(x/10),v=x%10,R=Math.floor(u/10),W=u%10;switch(M){case f.AddTenMinutes:{const D=v+u===0?7:6;return((C+1)%D*10+v)*60+u}case f.ReduceTenMinutes:{const D=v+u===0?7:6;return((C+D-1)%D*10+v)*60+u}case f.AddOneMinute:return(Math.min(5,C)*10+(v+1)%10)*60+u;case f.ReduceOneMinute:return(Math.min(5,C)*10+(v+10-1)%10)*60+u;case f.AddTenSeconds:return x*60+((R+1)%6*10+W);case f.ReduceTenSeconds:return x*60+((R+6-1)%6*10+W);case f.AddOneSecond:return x*60+(Math.min(5,R)*10+(W+1)%10);case f.ReduceOneSecond:return x*60+(Math.min(5,R)*10+(W+10-1)%10);default:return p}})},[g,e]);return y(()=>(n(e.isWritable),e.emitter.on("writableChange",n),()=>e.emitter.off("writableChange",n)),[e]),y(()=>{const M=p=>{p.countdownSecs&&l(o.state.countdownSecs),p.paused&&i(o.state.paused),p.startTime&&a(o.state.startTime)};return o.on("stateChanged",M)},[o]),y(()=>{e.isWritable&&o.setState({countdownSecs:c,paused:s,startTime:d})},[c,s,d,e]),t(q,{readonly:!r,countdownSecs:c,startTime:d,paused:s,onAdjustTime:O,onStart:h,onPause:w,onResume:k,onReset:F})}),G=208,B=216,Q={kind:"Countdown",config:{minwidth:G,minheight:B},setup(e){const o=e.box;o.mountStyles(_);const r=e.createStorage("state",{countdownSecs:0,startTime:0,paused:!1});U(t(E,{context:e,storage:r}),o.$content),e.emitter.on("destroy",()=>{U(null,o.$content)})}};export{Q as default};
