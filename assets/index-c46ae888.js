import{m as k,y as O,e as t,_ as H,A as v,d as P,S as T}from"./hooks.module-f2b10388.js";import{g as I}from"./compat.module-656ff7ba.js";import{c as U}from"./index-6332e3e2.js";const X=`.time-cell{display:flex;flex-flow:column nowrap;align-items:center;font-family:sans-serif;font-weight:700}.time-cell.disabled .time-cell-up:before,.time-cell.disabled .time-cell-down:after{border-top-color:#0000000d;border-bottom-color:#0000000d}.time-cell-up:before,.time-cell-down:after{content:"";display:block;width:0;height:0;margin:0 0 4px;border-top:0;border-left:12px solid transparent;border-right:12px solid transparent;border-bottom:12px solid #151515;transition:border-color .4s;cursor:pointer}.time-cell-down:after{margin:4px 0 0;border-top:12px solid #151515;border-bottom:0}.rotor{position:relative;width:36px;height:64px;border-radius:4px;font-size:48px;text-align:center;perspective:200px}.rotor-top,.rotor-bottom{overflow:hidden;position:absolute;width:36px;height:32px}.rotor-leaf{z-index:1;position:absolute;width:36px;height:64px;transform-style:preserve-3d;transition:transform 0s}.rotor-leaf.flipped{transform:rotateX(-180deg);transition:all .5s ease-in-out}.rotor-leaf-front,.rotor-leaf-rear{overflow:hidden;position:absolute;width:36px;height:32px;margin:0;transform:rotateX(0);backface-visibility:hidden;-webkit-backface-visibility:hidden}.rotor-leaf-front{line-height:64px;border-radius:4px 4px 0 0}.rotor-leaf-rear{line-height:0px;border-radius:0 0 4px 4px;transform:rotateX(-180deg)}.rotor-top{line-height:64px;border-radius:4px 4px 0 0}.rotor-bottom{bottom:0;line-height:0px;border-radius:0 0 4px 4px}.rotor:after{content:"";z-index:2;position:absolute;bottom:0px;left:0px;width:36px;height:32px;border-radius:0 0 4px 4px}.rotor,.rotor-top,.rotor-leaf-front{color:#fff;background-color:#151515}.rotor-bottom,.rotor-leaf-rear{color:#efefef;background-color:#202020}.rotor:after{border-top:solid 1px #151515}.telebox-color-scheme-dark .time-cell.disabled .time-cell-up:before,.telebox-color-scheme-dark .time-cell.disabled .time-cell-down:after{border-top-color:#ffffff14;border-bottom-color:#ffffff14}.telebox-color-scheme-dark .time-cell-up:before,.telebox-color-scheme-dark .time-cell-down:after{border-top-color:#d9d9df;border-bottom-color:#d9d9df}.telebox-color-scheme-dark .rotor,.telebox-color-scheme-dark .rotor-top,.telebox-color-scheme-dark .rotor-leaf-front{color:#383838;background-color:#efeff5}.telebox-color-scheme-dark .rotor-bottom,.telebox-color-scheme-dark .rotor-leaf-rear{color:#333;background-color:#eeecec}.telebox-color-scheme-dark .rotor:after{border-top:solid 1px #efeff5}.countdown-clock{display:flex;padding:5px}.countdown-clock>*{padding:0 5px}.countdown-clock-divider{display:flex;flex-direction:column;justify-content:center;align-items:center;padding:0 1px}.countdown-clock-divider:before,.countdown-clock-divider:after{content:"";display:block;width:8px;height:8px;margin:6px 0;background-color:#000;border-radius:50%}.netless-app-countdown{width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;transition:background-color .4s}.netless-app-countdown-shrink{display:inline-block;transition:background-color .4s}.netless-app-countdown-btns{width:100%;margin-top:10px;display:flex;flex-wrap:nowrap}.netless-app-countdown-btns>button{flex:1;display:block;margin:0 10px 0 0;padding:5px 10px;text-align:center;border:0;border-radius:4px;color:#fff;background-color:#3380ff;transition:background-color .4s,color .4s;cursor:pointer}.netless-app-countdown-btns>button:last-of-type{margin:0}.netless-app-countdown-btns>button:disabled{color:#00000040;background:#f5f5f5;cursor:not-allowed}.telebox-color-scheme-dark .netless-app-countdown-btns>button:disabled{color:#ffffff4d;background:rgba(255,255,255,.08)}
`,N=I(({digit:e,disabled:o,onUp:n,onDown:r})=>{const[c,l]=k(0),[f,u]=k(!1);return O(()=>{if(o){u(!0);const a=window.setTimeout(()=>{u(!1),l(e)},500);return()=>window.clearTimeout(a)}else l(e)},[e]),t("div",{class:U("time-cell",{disabled:o}),children:[t("div",{class:"time-cell-up",onClick:o?void 0:n}),t("div",{class:"rotor",children:[t("div",{class:U("rotor-leaf",{flipped:f}),children:[t("figure",{class:"rotor-leaf-rear",children:e}),t("figure",{class:"rotor-leaf-front",children:c})]}),t("div",{class:"rotor-top",children:e}),t("div",{class:"rotor-bottom",children:c})]}),t("div",{class:"time-cell-down",onClick:o?void 0:r})]})});var p=(e=>(e[e.AddTenMinutes=0]="AddTenMinutes",e[e.ReduceTenMinutes=1]="ReduceTenMinutes",e[e.AddOneMinute=2]="AddOneMinute",e[e.ReduceOneMinute=3]="ReduceOneMinute",e[e.AddTenSeconds=4]="AddTenSeconds",e[e.ReduceTenSeconds=5]="ReduceTenSeconds",e[e.AddOneSecond=6]="AddOneSecond",e[e.ReduceOneSecond=7]="ReduceOneSecond",e))(p||{});function z(e){return H(()=>(e=e%61,[Math.floor(e/10),e%10]),[e])}function w(e,o){return v(()=>e(o),[e])}const _=I(({minutes:e,seconds:o,disabled:n,onAdjustTime:r})=>{const c=z(e),l=z(o),f=w(r,0),u=w(r,1),a=w(r,2),b=w(r,3),g=w(r,4),m=w(r,5),x=w(r,6),S=w(r,7);return t("div",{className:"countdown-clock",children:[t(N,{disabled:n,digit:c[0],onUp:f,onDown:u}),t(N,{digit:c[1],disabled:n,onUp:a,onDown:b}),t("div",{class:"countdown-clock-divider"}),t(N,{disabled:n,digit:l[0],onUp:g,onDown:m}),t(N,{digit:l[1],disabled:n,onUp:x,onDown:S})]})}),$=I(({readonly:e,countdownSecs:o,startTime:n,paused:r,onAdjustTime:c,onStart:l,onPause:f,onResume:u,onReset:a})=>{const[b,g]=k(0),m=n>0&&b>=n,x=o-(m?b-n:0),S=Math.floor(x/60),F=x-S*60;return O(()=>{let y=NaN;if(o>0&&n>0&&!r){const h=()=>{g(Math.floor(Date.now()/1e3)),y=window.requestAnimationFrame(h)};return h(),()=>window.cancelAnimationFrame(y)}else window.cancelAnimationFrame(y)},[n,r,o]),O(()=>{n>0&&b-n>=o&&a()},[b,n,o,a]),t("div",{class:"netless-app-countdown",children:t("div",{class:"netless-app-countdown-shrink",children:[t(_,{minutes:S,seconds:F,disabled:e||m,onAdjustTime:c}),t("div",{class:"netless-app-countdown-btns",children:r?t(P,{children:[t("button",{onClick:a,disabled:e,children:"Reset"}),t("button",{onClick:u,disabled:e,children:"Resume"})]}):m?t("button",{onClick:f,disabled:e,children:"Pause"}):t("button",{onClick:l,disabled:e||x<=0,children:"Start"})})]})})}),q=I(({context:e,storage:o})=>{const[n,r]=k(()=>e.isWritable),[c,l]=k(o.state.countdownSecs),[f,u]=k(o.state.startTime),[a,b]=k(o.state.paused);O(()=>(r(e.isWritable),e.emitter.on("writableChange",r),()=>e.emitter.off("writableChange",r)),[e]),O(()=>{const h=s=>{s.countdownSecs&&l(o.state.countdownSecs),s.paused&&b(o.state.paused),s.startTime&&u(o.state.startTime)};return o.on("stateChanged",h)},[o]);const g=f>0,m=v(()=>{e.isWritable&&o.setState({paused:0,startTime:Math.floor(Date.now()/1e3)})},[e,o]),x=v(()=>{e.isWritable&&o.setState({paused:Math.floor(Date.now()/1e3)})},[e,o]),S=v(()=>{if(e.isWritable&&o.state.paused){const h=Math.floor(Date.now()/1e3),{startTime:s,paused:i}=o.state;o.setState({paused:0,startTime:s+h-i})}},[e,o]),F=v(()=>{e.isWritable&&o.setState({paused:0,countdownSecs:0,startTime:0})},[e]),y=v(h=>{if(!g&&e.isWritable){const s=Math.floor(c/60),i=c-s*60,C=Math.floor(s/10),M=s%10,R=Math.floor(i/10),D=i%10;let d;switch(h){case p.AddTenMinutes:{const W=M+i===0?7:6;d=((C+1)%W*10+M)*60+i;break}case p.ReduceTenMinutes:{const W=M+i===0?7:6;d=((C+W-1)%W*10+M)*60+i;break}case p.AddOneMinute:{d=(Math.min(5,C)*10+(M+1)%10)*60+i;break}case p.ReduceOneMinute:{d=(Math.min(5,C)*10+(M+10-1)%10)*60+i;break}case p.AddTenSeconds:{d=s*60+((R+1)%6*10+D);break}case p.ReduceTenSeconds:{d=s*60+((R+6-1)%6*10+D);break}case p.AddOneSecond:{d=s*60+(Math.min(5,R)*10+(D+1)%10);break}case p.ReduceOneSecond:{d=s*60+(Math.min(5,R)*10+(D+10-1)%10);break}default:{d=c;break}}o.setState({countdownSecs:d})}},[g,c,e,o]);return t($,{readonly:!n,countdownSecs:c,startTime:f,paused:a>0,onAdjustTime:y,onStart:m,onPause:x,onResume:S,onReset:F})}),E=208,G=216,L={kind:"Countdown",config:{minwidth:E,minheight:G},setup(e){const o=e.box;o.mountStyles(X);const n=e.createStorage("state",{countdownSecs:0,startTime:0,paused:0});T(t(q,{context:e,storage:n}),o.$content),e.emitter.on("destroy",()=>{T(null,o.$content)})}};export{L as default};
