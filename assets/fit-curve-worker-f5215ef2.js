(function(){"use strict";self.onmessage=n=>{const{id:e,path:t,error:r}=n.data;postMessage({id:e,curves:k(t,r)})};/**
 *  @preserve  JavaScript implementation of
 *  Algorithm for Automatically Fitting Digitized Curves
 *  by Philip J. Schneider
 *  "Graphics Gems", Academic Press, 1990
 *
 *  The MIT License (MIT)
 *
 *  https://github.com/soswow/fit-curves
 */const D=Object.freeze({x:0,y:0});function U(n,e){return Math.sqrt((n.x-e.x)**2+(n.y-e.y)**2)}function g(n){return Math.sqrt(n.x**2+n.y**2)}function R(n){return n.x**2+n.y**2}function l(n,e){return{x:n.x+e.x,y:n.y+e.y}}function B(...n){return{x:n.reduce((e,t)=>e+t.x,0),y:n.reduce((e,t)=>e+t.y,0)}}function a(n,e){return{x:n.x-e.x,y:n.y-e.y}}function i(n,e){return{x:n.x*e,y:n.y*e}}function j(n,e){return{x:n.x/e,y:n.y/e}}function L(n){const e=g(n);return e===0?n:j(n,e)}function C(n,e){return n.x*e.x+n.y*e.y}function k(n,e){if(n.length<2)return[];const t=n.length,r=X(n[1],n[0]),c=X(n[t-2],n[t-1]);return q(n,r,c,e)}function q(n,e,t,r){if(n.length===2){const m=U(n[0],n[1])/3;return[[n[0],l(n[0],i(e,m)),l(n[1],i(t,m)),n[1]]]}const o=S(n);let[u,f,s]=Q(n,o,o,e,t);if(f===0||f<r)return[u];if(f<r*r){let m=o,v=f,_=s;for(let M=0;M<20;M++){if(m=F(u,n,m),[u,f,s]=Q(n,o,m,e,t),f<r)return[u];if(s===_){const h=f/v;if(h>.9999&&h<1.0001)break}v=f,_=s}}const x=[];let d=a(n[s-1],n[s+1]);if(d.x===0&&d.y===0){const{x:m,y:v}=a(n[s-1],n[s]);d={x:-v,y:m}}const N=L(d),A=i(N,-1);return x.push(...q(n.slice(0,s+1),e,N,r)),x.push(...q(n.slice(s),A,t,r)),x}function Q(n,e,t,r,c){const o=w(n,t,r,c),[u,f]=V(n,o,e);return[o,u,f]}function w(n,e,t,r){const c=n[0],o=n[n.length-1],u=[c,D,D,o],f=e.map(h=>{const b=1-h;return[i(t,3*h*(b*b)),i(r,3*b*(h*h))]}),s=[[0,0],[0,0]],x=[0,0];for(const[h,b]of e.entries()){const[y,z]=f[h];s[0][0]+=C(y,y),s[0][1]+=C(y,z),s[1][0]+=C(y,z),s[1][1]+=C(z,z);const I=a(n[h],E([c,c,o,o],b));x[0]+=C(y,I),x[1]+=C(z,I)}const d=s[0][0]*s[1][1]-s[1][0]*s[0][1],N=s[0][0]*x[1]-s[1][0]*x[0],A=x[0]*s[1][1]-x[1]*s[0][1],m=d===0?0:A/d,v=d===0?0:N/d,_=g(a(c,o)),M=1e-6*_;return m<M||v<M?(u[1]=l(c,i(t,_/3)),u[2]=l(o,i(r,_/3))):(u[1]=l(c,i(t,m)),u[2]=l(o,i(r,v))),u}function F(n,e,t){return t.map((r,c)=>O(n,e[c],r))}function O(n,e,t){const r=a(E(n,t),e),c=J(n,t),o=C(r,c),u=R(c)+2*C(r,K(n,t));return u===0?t:t-o/u}function S(n){let e=[],t,r,c;return n.forEach((o,u)=>{t=u>0?r+g(a(o,c)):0,e.push(t),r=t,c=o}),e=e.map(o=>o/r),e}function V(n,e,t){let r=0,c=Math.floor(n.length/2);const o=G(e,10);for(let u=1;u<n.length-1;u++){const f=n[u],s=H(e,t[u],o,10),x=a(E(e,s),f),d=R(x);d>r&&(r=d,c=u)}return[r,c]}function G(n,e){let t=[0],r=n[0],c=0;for(let o=1;o<=e;o++){const u=E(n,o/e);c+=g(a(u,r)),t.push(c),r=u}return t=t.map(o=>o/c),t}function H(n,e,t,r){if(e<0)return 0;if(e>1)return 1;for(let c=1;c<=r;c++)if(e<=t[c]){const o=(c-1)/r,u=c/r,f=t[c-1],s=t[c];return(e-f)/(s-f)*(u-o)+o}return Number.NaN}function X(n,e){return L(a(n,e))}function E(n,e){const t=1-e,r=i(n[0],t**3),c=i(n[1],3*t**2*e),o=i(n[2],3*t*e**2),u=i(n[3],e**3);return B(r,c,o,u)}function J(n,e){const t=1-e,r=i(a(n[1],n[0]),3*t**2),c=i(a(n[2],n[1]),6*t*e),o=i(a(n[3],n[2]),3*e**2);return B(r,c,o)}function K(n,e){return l(i(l(a(n[2],i(n[1],2)),n[0]),6*(1-e)),i(l(a(n[3],i(n[2],2)),n[1]),6*e))}})();
