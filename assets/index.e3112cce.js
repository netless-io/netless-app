import{S as Q,i as R,s as T,e as h,d,F as I,g as A,h as g,x as E,m as V,b as S,Q as O,n as C,p as U,o as q,J as D,G as H,R as K}from"./vendor.0047f732.js";var N="assets/pencil.614cc8ea.svg",W="assets/pencil-off.f49ce2a4.svg",L="assets/plus.4b34cdbf.svg",M="assets/close.c4eb3b01.svg",X="assets/up.c9e084a4.svg";function j(e,l,t){const o=e.slice();return o[16]=l[t],o[17]=l,o[18]=t,o}function z(e){let l,t,o,u,n,a;return{c(){l=h("button"),t=h("img"),d(t,"draggable","false"),I(t.src,o=L)||d(t,"src",o),d(t,"alt","add"),d(l,"title","Add"),l.disabled=u=e[1].length>=20},m(s,f){A(s,l,f),g(l,t),n||(a=E(l,"click",e[7]),n=!0)},p(s,f){f&2&&u!==(u=s[1].length>=20)&&(l.disabled=u)},d(s){s&&V(l),n=!1,a()}}}function B(e){let l,t,o,u,n;return{c(){l=h("button"),t=h("img"),d(t,"draggable","false"),I(t.src,o=e[4]?W:N)||d(t,"src",o),d(t,"alt","edit"),d(l,"title","Edit")},m(a,s){A(a,l,s),g(l,t),u||(n=E(l,"click",e[5]),u=!0)},p(a,s){s&16&&!I(t.src,o=a[4]?W:N)&&d(t,"src",o)},d(a){a&&V(l),u=!1,n()}}}function F(e){let l,t,o=(e[2][e[18]]||0)+"",u,n,a,s,f,_,c,m;function k(){return e[12](e[18])}return{c(){l=h("span"),t=C("("),u=C(o),n=C(")"),a=S(),s=h("button"),f=h("img"),d(l,"class","netless-app-vote-count"),d(f,"draggable","false"),I(f.src,_=X)||d(f,"src",_),d(f,"alt","vote"),d(s,"title","Vote")},m(r,b){A(r,l,b),g(l,t),g(l,u),g(l,n),A(r,a,b),A(r,s,b),g(s,f),c||(m=E(s,"click",k),c=!0)},p(r,b){e=r,b&4&&o!==(o=(e[2][e[18]]||0)+"")&&U(u,o)},d(r){r&&V(l),r&&V(a),r&&V(s),c=!1,m()}}}function J(e){let l,t,o,u,n;function a(){return e[13](e[18])}return{c(){l=h("button"),t=h("img"),d(t,"draggable","false"),I(t.src,o=M)||d(t,"src",o),d(t,"alt","delete"),d(l,"title","Delete")},m(s,f){A(s,l,f),g(l,t),u||(n=E(l,"click",a),u=!0)},p(s,f){e=s},d(s){s&&V(l),u=!1,n()}}}function P(e){let l,t,o,u,n,a,s,f;function _(){e[11].call(t,e[17],e[18])}let c=!e[4]&&F(e),m=e[4]&&J(e);return{c(){l=h("li"),t=h("input"),u=S(),c&&c.c(),n=S(),m&&m.c(),a=S(),d(t,"class","netless-app-vote-item"),t.readOnly=o=!e[4]},m(k,r){A(k,l,r),g(l,t),O(t,e[16]),g(l,u),c&&c.m(l,null),g(l,n),m&&m.m(l,null),g(l,a),s||(f=E(t,"input",_),s=!0)},p(k,r){e=k,r&16&&o!==(o=!e[4])&&(t.readOnly=o),r&2&&t.value!==e[16]&&O(t,e[16]),e[4]?c&&(c.d(1),c=null):c?c.p(e,r):(c=F(e),c.c(),c.m(l,n)),e[4]?m?m.p(e,r):(m=J(e),m.c(),m.m(l,a)):m&&(m.d(1),m=null)},d(k){k&&V(l),c&&c.d(),m&&m.d(),s=!1,f()}}}function Y(e){let l,t,o,u,n,a,s=(e[0]||"what to eat")+"",f,_,c,m,k,r=e[4]&&z(e),b=e[3]&&B(e),y=e[1],v=[];for(let p=0;p<y.length;p+=1)v[p]=P(j(e,y,p));return{c(){l=h("div"),t=h("div"),r&&r.c(),o=S(),b&&b.c(),u=S(),n=h("div"),a=h("h2"),f=C(s),_=S(),c=h("ul");for(let p=0;p<v.length;p+=1)v[p].c();d(t,"class","netless-app-vote-controls"),d(a,"contenteditable",e[4]),q(a,"editing",e[4]),d(n,"class","netless-app-vote-title"),d(c,"class","netless-app-vote-items"),d(l,"class","netless-app-vote"),d(l,"data-kind","vote")},m(p,w){A(p,l,w),g(l,t),r&&r.m(t,null),g(t,o),b&&b.m(t,null),g(l,u),g(l,n),g(n,a),g(a,f),g(l,_),g(l,c);for(let i=0;i<v.length;i+=1)v[i].m(c,null);m||(k=E(a,"input",e[6]),m=!0)},p(p,[w]){if(p[4]?r?r.p(p,w):(r=z(p),r.c(),r.m(t,o)):r&&(r.d(1),r=null),p[3]?b?b.p(p,w):(b=B(p),b.c(),b.m(t,null)):b&&(b.d(1),b=null),w&1&&s!==(s=(p[0]||"what to eat")+"")&&U(f,s),w&16&&d(a,"contenteditable",p[4]),w&16&&q(a,"editing",p[4]),w&790){y=p[1];let i;for(i=0;i<y.length;i+=1){const G=j(p,y,i);v[i]?v[i].p(G,w):(v[i]=P(G),v[i].c(),v[i].m(c,null))}for(;i<v.length;i+=1)v[i].d(1);v.length=y.length}},i:D,o:D,d(p){p&&V(l),r&&r.d(),b&&b.d(),H(v,p),m=!1,k()}}}function Z(e,l,t){let o;const u=K();let{writable:n=!1}=l,{title:a=""}=l,{items:s=["lorem","ipsum","dolo","sit","amet"]}=l,{votes:f=[0,0,0,0,0]}=l,_="vote";function c(){t(10,_=o?"vote":"edit"),_==="vote"&&(t(2,f=Array(s.length).fill(0)),b())}function m(i){t(0,a=i.target.textContent||"")}function k(){t(1,s=s.concat([""]))}function r(i){t(1,s=s.slice(0,i).concat(s.slice(i+1)))}function b(){n&&(f.forEach((i,G)=>{u("update",{votes:[G,i]})}),u("update",{title:a,items:s}))}function y(i){n&&u("update",{votes:[i,f[i]+1]})}function v(i,G){i[G]=this.value,t(1,s)}const p=i=>y(i),w=i=>r(i);return e.$$set=i=>{"writable"in i&&t(3,n=i.writable),"title"in i&&t(0,a=i.title),"items"in i&&t(1,s=i.items),"votes"in i&&t(2,f=i.votes)},e.$$.update=()=>{e.$$.dirty&1024&&t(4,o=_==="edit")},[a,s,f,n,o,c,m,k,r,y,_,v,p,w]}class x extends Q{constructor(l){super();R(this,l,Z,Y,T,{writable:3,title:0,items:1,votes:2})}}var $=`.netless-app-vote{width:100%;height:100%;background-color:#fff;display:flex;flex-flow:column nowrap}.netless-app-vote [contenteditable=true]{border-bottom:1px dashed #ccc}.netless-app-vote button{height:25px;gap:4px;background-color:transparent;border:2px solid transparent;border-radius:4px}.netless-app-vote button:hover{border-color:#ccc}.netless-app-vote button:active{background-color:#ccc}.netless-app-vote button img{width:16px;height:16px}.netless-app-vote-controls{position:absolute;top:8px;right:8px}.netless-app-vote-title{padding:8px}.netless-app-vote-title h2{margin:0;padding:2px 8px;display:inline-block;line-height:1.1;color:#333;border-bottom:1px dashed transparent}.netless-app-vote-items{flex-grow:1;margin:0;padding:0 8px 12px;list-style-type:none;overflow-y:auto}.netless-app-vote-items li{display:flex;align-items:center;gap:5px;line-height:1.5;padding-bottom:4px}.netless-app-vote-items li button{display:inline-block}.netless-app-vote-item{display:block;font-size:16px;line-height:1.5;font-family:Arial,sans-serif;flex-grow:1;border:1px solid #eee;border-radius:4px;padding:2px 8px}.netless-app-vote-item[readonly]{border-color:transparent}.netless-app-vote-count{padding-right:8px}.telebox-color-scheme-dark .netless-app-vote{color-scheme:dark;background-color:#121212;color:#eee}.telebox-color-scheme-dark [contenteditable=true]{border-bottom-color:#666}.telebox-color-scheme-dark button:hover{border-color:#666}.telebox-color-scheme-dark button:active{background-color:#666}.telebox-color-scheme-dark button img{filter:invert(1)}.telebox-color-scheme-dark .netless-app-vote-title h2{color:#ccc}.telebox-color-scheme-dark .netless-app-vote-item{border-color:#666}
`;const te={kind:"Vote",setup(e){const l=e.getBox();let t=e.getAttributes();if(t||(e.setAttributes({title:"",items:[]}),t=e.getAttributes()),!t){e.emitter.emit("destroy",{error:new Error("[NetlessAppVote] No attributes")});return}t.title==null&&e.updateAttributes(["title"],""),t.items||e.updateAttributes(["items"],[]),l.mountStyles($);const o=new x({target:l.$content,props:{writable:e.getIsWritable()}});e.emitter.on("writableChange",()=>{o.$set({writable:e.getIsWritable()})}),o.$on("update",({detail:n})=>{if("title"in n&&e.updateAttributes(["title"],n.title),"items"in n&&e.updateAttributes(["items"],n.items),Array.isArray(n.votes)){const[a,s]=n.votes;e.updateAttributes([`item-${a}`],s)}});const u=[e.mobxUtils.autorun(()=>{o.$set({title:t.title})}),e.mobxUtils.autorun(()=>{t.items&&o.$set({items:[...t.items]})}),e.mobxUtils.autorun(()=>{t.items&&o.$set({votes:t.items.map((n,a)=>t[`item-${a}`]||0)})})];e.emitter.on("destroy",()=>{u.forEach(n=>n()),o.$destroy()})}};export{te as default};
