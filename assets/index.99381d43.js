var Fe=Object.defineProperty;var We=(e,t,s)=>t in e?Fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var a=(e,t,s)=>(We(e,typeof t!="symbol"?t+"":t,s),s);import{V as E,R as Ye,w as P,x as b,z as je,B as Ge}from"./index.dc7b70a6.js";import"./modulepreload-polyfill.c7c6310f.js";const qe=`.netless-app-docs-viewer-footer{box-sizing:border-box;height:26px;display:flex;align-items:center;padding:0 16px;border-top:1px solid #eeeef7;font-family:PingFang SC,Source Han Sans SC,Microsoft YaHei,Helvetica Neue,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif}.netless-app-docs-viewer-footer-btn{box-sizing:border-box;width:26px;height:26px;font-size:0;margin:0;padding:3px;border:none;border-radius:1px;outline:none;color:currentColor;background:transparent;transition:background .4s;cursor:pointer;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}.netless-app-docs-viewer-footer-btn:hover{background:rgba(237,237,240,.9)}@media (hover: none){.netless-app-docs-viewer-footer-btn:hover{background:transparent!important}}.netless-app-docs-viewer-footer-btn>svg{width:100%;height:100%}.netless-app-docs-viewer-footer-btn>svg:nth-of-type(2){display:none}.netless-app-docs-viewer-footer-btn.netless-app-docs-viewer-footer-btn-playing>svg:nth-of-type(1){display:none}.netless-app-docs-viewer-footer-btn.netless-app-docs-viewer-footer-btn-playing>svg:nth-of-type(2){display:initial}.netless-app-docs-viewer-footer-btn~.netless-app-docs-viewer-footer-btn{margin-left:15px}.netless-app-docs-viewer-page-jumps{flex:1;display:flex;justify-content:center;align-items:center}.netless-app-docs-viewer-page-number{display:flex;align-items:center;height:26px;margin-left:auto;font-size:13px;white-space:nowrap;word-break:keep-all;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.netless-app-docs-viewer-page-number-input{border:none;outline:none;width:3em;margin:0;padding:0 .5em 0 2px;text-align:right;font-size:13px;line-height:1;font-weight:400;font-family:inherit;border-radius:2px;color:currentColor;font-family:PingFang SC,Source Han Sans SC,Microsoft YaHei,Helvetica Neue,Noto Sans CJK SC,WenQuanYi Micro Hei,sans-serif;background:transparent;transition:background .4s;-webkit-tap-highlight-color:rgba(0,0,0,0)}.netless-app-docs-viewer-page-number-input:hover,.netless-app-docs-viewer-page-number-input:focus,.netless-app-docs-viewer-page-number-input:active{user-select:text;background:#fff;box-shadow:#63636333 0 2px 8px}.netless-app-docs-viewer-readonly .netless-app-docs-viewer-footer-btn{cursor:not-allowed}.netless-app-docs-viewer-readonly .netless-app-docs-viewer-footer-btn:hover{background:transparent}.netless-app-docs-viewer-readonly .netless-app-docs-viewer-page-number-input{cursor:not-allowed}.netless-app-docs-viewer-readonly .netless-app-docs-viewer-page-number-input:hover,.netless-app-docs-viewer-readonly .netless-app-docs-viewer-page-number-input:focus,.netless-app-docs-viewer-readonly .netless-app-docs-viewer-page-number-input:active{background:transparent;box-shadow:none}.netless-app-docs-viewer-readonly .netless-app-docs-viewer-page-number-input:disabled{color:inherit}.telebox-color-scheme-dark .netless-app-docs-viewer-page-number-input:active,.telebox-color-scheme-dark .netless-app-docs-viewer-page-number-input:focus,.telebox-color-scheme-dark .netless-app-docs-viewer-page-number-input:hover{color:currentColor;background:#25282e}.telebox-color-scheme-dark .netless-app-docs-viewer-footer{border-top:none}.telebox-color-scheme-dark .netless-app-docs-viewer-footer-btn:hover{background:#212126}.netless-app-docs-viewer-preview-mask{position:absolute;z-index:10200;top:0;left:0;width:100%;height:100%}.netless-app-docs-viewer-preview{box-sizing:border-box;display:flex;flex-direction:column;align-items:center;position:absolute;z-index:10300;top:0;left:0;width:33%;max-width:200px;height:100%;padding-top:10px;transform:translate(-100%);background:rgba(237,237,240,.9);box-shadow:inset -1px 0 #0000001c;transition:transform .4s;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.netless-app-docs-viewer-preview.netless-app-docs-viewer-preview-active{transform:translate(0)}.netless-app-docs-viewer-preview-page{position:relative;display:block;width:55%;margin-bottom:10px;font-size:0;color:transparent;outline:none;border:7px solid transparent;border-radius:4px;transition:border-color .3s;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.netless-app-docs-viewer-preview-page:hover,.netless-app-docs-viewer-preview-page.netless-app-docs-viewer-preview-page-active{border-color:#444e601a}.netless-app-docs-viewer-preview-page>img{width:100%;height:auto;box-sizing:border-box;border:1px solid rgba(0,0,0,.5);border-radius:1px;background-color:#fff;box-shadow:0 2px 8px #0000004d}.netless-app-docs-viewer-preview-page-name{position:absolute;top:1px;left:-10px;transform:translate(-100%);text-align:right;font-size:12px;color:#5f5f5f;user-select:none}.telebox-color-scheme-dark .netless-app-docs-viewer-preview{background:rgba(50,50,50,.9)}.netless-app-docs-viewer-content{position:relative;height:100%;overflow:hidden}.netless-app-docs-viewer-static-scrollbar{box-sizing:border-box;position:absolute;top:0;right:0;z-index:2147483647;width:16px;min-height:30px;margin:0;padding:0 0 0 8px;border:none;outline:none;opacity:0;background:transparent;transition:opacity .4s 3s,transform .1s;user-select:none;touch-action:none}.netless-app-docs-viewer-static-scrollbar:after{content:"";display:block;width:8px;height:100%;border-radius:4px;background:rgba(68,78,96,.4);box-shadow:1px 1px 8px #ffffffb3;transition:background .4s}.netless-app-docs-viewer-static-scrollbar.netless-app-docs-viewer-static-scrolling{opacity:1;transition:opacity .4s,transform .1s}.netless-app-docs-viewer-static-scrollbar.netless-app-docs-viewer-static-scrollbar-dragging{opacity:1;transition:opacity .4s 3s!important}.netless-app-docs-viewer-static-scrollbar.netless-app-docs-viewer-static-scrollbar-dragging:after{background:rgba(68,78,96,.6)}.netless-app-docs-viewer-static-scrollbar:hover:after,.netless-app-docs-viewer-static-scrollbar:focus:after{background:rgba(68,78,96,.5)}.netless-app-docs-viewer-static-scrollbar:active:after{background:rgba(68,78,96,.6)}.telebox-body-wrap:hover .netless-app-docs-viewer-static-scrollbar{opacity:1;transition:opacity .4s,transform .1s}.telebox-readonly .netless-app-docs-viewer-static-scrollbar{display:none}.page-renderer-pages-container{position:relative;width:100%;height:100%}.page-renderer-page{position:absolute;top:0;left:0;background-position:center;background-size:cover;background-repeat:no-repeat}.page-renderer-pages-container.is-hwa .page-renderer-page{will-change:transform}.page-renderer-page-img{display:block;width:100%;height:auto;user-select:none}.netless-app-docs-viewer-static-pages{overflow:hidden;position:relative;height:100%;user-select:none}.netless-app-docs-viewer-static-page{display:block;width:100%;height:auto;user-select:none}.netless-app-docs-viewer-dynamic-wb-view{position:absolute;top:0;left:0;width:100%;height:100%;z-index:100;overflow:hidden}.netless-app-docs-viewer-dynamic-wb-view .cursor-clicker .ppt-event-source{cursor:pointer}
`,Je="!#%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",Xe=87,Ke=20,ie=[],Qe=()=>{for(let e=0;e<Ke;e++)ie[e]=Je.charAt(Math.random()*Xe);return ie.join("")};function he(e){try{return e()}catch(t){console.error(t)}}class N{constructor(){this.push=this.addDisposer,this.disposers=new Map}addDisposer(t,s=this.genUID()){return this.flush(s),this.disposers.set(s,Array.isArray(t)?Ze(t):t),s}add(t,s=this.genUID()){const r=t();return r?this.addDisposer(r,s):s}addEventListener(t,s,r,i,n=this.genUID()){return t.addEventListener(s,r,i),this.addDisposer(()=>t.removeEventListener(s,r,i),n),n}setTimeout(t,s,r=this.genUID()){const i=window.setTimeout(()=>{this.remove(r),t()},s);return this.addDisposer(()=>window.clearTimeout(i),r)}setInterval(t,s,r=this.genUID()){const i=window.setInterval(t,s);return this.addDisposer(()=>window.clearInterval(i),r)}remove(t){const s=this.disposers.get(t);return this.disposers.delete(t),s}flush(t){const s=this.remove(t);if(s)try{s()}catch(r){console.error(r)}}flushAll(){this.disposers.forEach(he),this.disposers.clear()}genUID(){let t;do t=Qe();while(this.disposers.has(t));return t}}function Ze(e){return()=>e.forEach(he)}const C=typeof window<"u",pe=C&&!("onscroll"in window)||typeof navigator<"u"&&/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent),ue=C&&"IntersectionObserver"in window,ge=C&&"classList"in document.createElement("p"),fe=C&&window.devicePixelRatio>1,et={elements_selector:".lazy",container:pe||C?document:null,threshold:300,thresholds:null,data_src:"src",data_srcset:"srcset",data_sizes:"sizes",data_bg:"bg",data_bg_hidpi:"bg-hidpi",data_bg_multi:"bg-multi",data_bg_multi_hidpi:"bg-multi-hidpi",data_bg_set:"bg-set",data_poster:"poster",class_applied:"applied",class_loading:"loading",class_loaded:"loaded",class_error:"error",class_entered:"entered",class_exited:"exited",unobserve_completed:!0,unobserve_entered:!1,cancel_on_exit:!0,callback_enter:null,callback_exit:null,callback_applied:null,callback_loading:null,callback_loaded:null,callback_error:null,callback_finish:null,callback_cancel:null,use_native:!1,restore_on_error:!1},we=e=>Object.assign({},et,e),ae=function(e,t){let s;const r="LazyLoad::Initialized",i=new e(t);try{s=new CustomEvent(r,{detail:{instance:i}})}catch{s=document.createEvent("CustomEvent"),s.initCustomEvent(r,!1,!1,{instance:i})}window.dispatchEvent(s)},tt=(e,t)=>{if(!!t)if(!t.length)ae(e,t);else for(let s=0,r;r=t[s];s+=1)ae(e,r)},$="src",Y="srcset",j="sizes",ve="poster",z="llOriginalAttrs",be="data",G="loading",me="loaded",Se="applied",st="entered",q="error",Ee="native",$e="data-",ye="ll-status",v=(e,t)=>e.getAttribute($e+t),rt=(e,t,s)=>{var r=$e+t;if(s===null){e.removeAttribute(r);return}e.setAttribute(r,s)},R=e=>v(e,ye),T=(e,t)=>rt(e,ye,t),H=e=>T(e,null),J=e=>R(e)===null,it=e=>R(e)===G,at=e=>R(e)===q,X=e=>R(e)===Ee,ot=[G,me,Se,q],nt=e=>ot.indexOf(R(e))>=0,k=(e,t,s,r)=>{if(!!e){if(r!==void 0){e(t,s,r);return}if(s!==void 0){e(t,s);return}e(t)}},A=(e,t)=>{if(ge){e.classList.add(t);return}e.className+=(e.className?" ":"")+t},S=(e,t)=>{if(ge){e.classList.remove(t);return}e.className=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ").replace(/^\s+/,"").replace(/\s+$/,"")},ct=e=>{e.llTempImage=document.createElement("IMG")},lt=e=>{delete e.llTempImage},xe=e=>e.llTempImage,B=(e,t)=>{if(!t)return;const s=t._observer;!s||s.unobserve(e)},dt=e=>{e.disconnect()},ht=(e,t,s)=>{t.unobserve_entered&&B(e,s)},K=(e,t)=>{!e||(e.loadingCount+=t)},pt=e=>{!e||(e.toLoadCount-=1)},_e=(e,t)=>{!e||(e.toLoadCount=t)},ut=e=>e.loadingCount>0,gt=e=>e.toLoadCount>0,Ce=e=>{let t=[];for(let s=0,r;r=e.children[s];s+=1)r.tagName==="SOURCE"&&t.push(r);return t},Q=(e,t)=>{const s=e.parentNode;if(!s||s.tagName!=="PICTURE")return;Ce(s).forEach(t)},ke=(e,t)=>{Ce(e).forEach(t)},U=[$],Le=[$,ve],M=[$,Y,j],Ne=[be],F=e=>!!e[z],Te=e=>e[z],Ie=e=>delete e[z],I=(e,t)=>{if(F(e))return;const s={};t.forEach(r=>{s[r]=e.getAttribute(r)}),e[z]=s},ft=e=>{F(e)||(e[z]={backgroundImage:e.style.backgroundImage})},wt=(e,t,s)=>{if(!s){e.removeAttribute(t);return}e.setAttribute(t,s)},L=(e,t)=>{if(!F(e))return;const s=Te(e);t.forEach(r=>{wt(e,r,s[r])})},vt=e=>{if(!F(e))return;const t=Te(e);e.style.backgroundImage=t.backgroundImage},Ae=(e,t,s)=>{A(e,t.class_applied),T(e,Se),s&&(t.unobserve_completed&&B(e,t),k(t.callback_applied,e,s))},De=(e,t,s)=>{A(e,t.class_loading),T(e,G),s&&(K(s,1),k(t.callback_loading,e,s))},_=(e,t,s)=>{!s||e.setAttribute(t,s)},oe=(e,t)=>{_(e,j,v(e,t.data_sizes)),_(e,Y,v(e,t.data_srcset)),_(e,$,v(e,t.data_src))},bt=(e,t)=>{Q(e,s=>{I(s,M),oe(s,t)}),I(e,M),oe(e,t)},mt=(e,t)=>{I(e,U),_(e,$,v(e,t.data_src))},St=(e,t)=>{ke(e,s=>{I(s,U),_(s,$,v(s,t.data_src))}),I(e,Le),_(e,ve,v(e,t.data_poster)),_(e,$,v(e,t.data_src)),e.load()},Et=(e,t)=>{I(e,Ne),_(e,be,v(e,t.data_src))},$t=(e,t,s)=>{const r=v(e,t.data_bg),i=v(e,t.data_bg_hidpi),n=fe&&i?i:r;!n||(e.style.backgroundImage=`url("${n}")`,xe(e).setAttribute($,n),De(e,t,s))},yt=(e,t,s)=>{const r=v(e,t.data_bg_multi),i=v(e,t.data_bg_multi_hidpi),n=fe&&i?i:r;!n||(e.style.backgroundImage=n,Ae(e,t,s))},xt=(e,t,s)=>{const r=v(e,t.data_bg_set);if(!r)return;const i=r.split("|");let n=i.map(c=>`image-set(${c})`);e.style.backgroundImage=n.join(),e.style.backgroundImage===""&&(n=i.map(c=>`-webkit-image-set(${c})`),e.style.backgroundImage=n.join()),Ae(e,t,s)},Pe={IMG:bt,IFRAME:mt,VIDEO:St,OBJECT:Et},_t=(e,t)=>{const s=Pe[e.tagName];!s||s(e,t)},Ct=(e,t,s)=>{const r=Pe[e.tagName];!r||(r(e,t),De(e,t,s))},kt=["IMG","IFRAME","VIDEO","OBJECT"],Lt=e=>kt.indexOf(e.tagName)>-1,Me=(e,t)=>{t&&!ut(t)&&!gt(t)&&k(e.callback_finish,t)},ne=(e,t,s)=>{e.addEventListener(t,s),e.llEvLisnrs[t]=s},Nt=(e,t,s)=>{e.removeEventListener(t,s)},Z=e=>!!e.llEvLisnrs,Tt=(e,t,s)=>{Z(e)||(e.llEvLisnrs={});const r=e.tagName==="VIDEO"?"loadeddata":"load";ne(e,r,t),ne(e,"error",s)},W=e=>{if(!Z(e))return;const t=e.llEvLisnrs;for(let s in t){const r=t[s];Nt(e,s,r)}delete e.llEvLisnrs},ze=(e,t,s)=>{lt(e),K(s,-1),pt(s),S(e,t.class_loading),t.unobserve_completed&&B(e,s)},It=(e,t,s,r)=>{const i=X(t);ze(t,s,r),A(t,s.class_loaded),T(t,me),k(s.callback_loaded,t,r),i||Me(s,r)},At=(e,t,s,r)=>{const i=X(t);ze(t,s,r),A(t,s.class_error),T(t,q),k(s.callback_error,t,r),s.restore_on_error&&L(t,M),i||Me(s,r)},ee=(e,t,s)=>{const r=xe(e)||e;if(Z(r))return;Tt(r,c=>{It(c,e,t,s),W(r)},c=>{At(c,e,t,s),W(r)})},Dt=(e,t,s)=>{ct(e),ee(e,t,s),ft(e),$t(e,t,s),yt(e,t,s),xt(e,t,s)},Pt=(e,t,s)=>{ee(e,t,s),Ct(e,t,s)},te=(e,t,s)=>{Lt(e)?Pt(e,t,s):Dt(e,t,s)},Mt=(e,t,s)=>{e.setAttribute("loading","lazy"),ee(e,t,s),_t(e,t),T(e,Ee)},ce=e=>{e.removeAttribute($),e.removeAttribute(Y),e.removeAttribute(j)},zt=e=>{Q(e,t=>{ce(t)}),ce(e)},Re=e=>{Q(e,t=>{L(t,M)}),L(e,M)},Rt=e=>{ke(e,t=>{L(t,U)}),L(e,Le),e.load()},Vt=e=>{L(e,U)},Ot=e=>{L(e,Ne)},Ht={IMG:Re,IFRAME:Vt,VIDEO:Rt,OBJECT:Ot},Bt=e=>{const t=Ht[e.tagName];if(!t){vt(e);return}t(e)},Ut=(e,t)=>{J(e)||X(e)||(S(e,t.class_entered),S(e,t.class_exited),S(e,t.class_applied),S(e,t.class_loading),S(e,t.class_loaded),S(e,t.class_error))},Ft=(e,t)=>{Bt(e),Ut(e,t),H(e),Ie(e)},Wt=(e,t,s,r)=>{!s.cancel_on_exit||!it(e)||e.tagName==="IMG"&&(W(e),zt(e),Re(e),S(e,s.class_loading),K(r,-1),H(e),k(s.callback_cancel,e,t,r))},Yt=(e,t,s,r)=>{const i=nt(e);T(e,st),A(e,s.class_entered),S(e,s.class_exited),ht(e,s,r),k(s.callback_enter,e,t,r),!i&&te(e,s,r)},jt=(e,t,s,r)=>{J(e)||(A(e,s.class_exited),Wt(e,t,s,r),k(s.callback_exit,e,t,r))},Gt=["IMG","IFRAME","VIDEO"],Ve=e=>e.use_native&&"loading"in HTMLImageElement.prototype,qt=(e,t,s)=>{e.forEach(r=>{Gt.indexOf(r.tagName)!==-1&&Mt(r,t,s)}),_e(s,0)},Jt=e=>e.isIntersecting||e.intersectionRatio>0,Xt=e=>({root:e.container===document?null:e.container,rootMargin:e.thresholds||e.threshold+"px"}),Kt=(e,t,s)=>{e.forEach(r=>Jt(r)?Yt(r.target,r,t,s):jt(r.target,r,t,s))},Qt=(e,t)=>{t.forEach(s=>{e.observe(s)})},Zt=(e,t)=>{dt(e),Qt(e,t)},es=(e,t)=>{!ue||Ve(e)||(t._observer=new IntersectionObserver(s=>{Kt(s,e,t)},Xt(e)))},Oe=e=>Array.prototype.slice.call(e),O=e=>e.container.querySelectorAll(e.elements_selector),ts=e=>Oe(e).filter(J),ss=e=>at(e),rs=e=>Oe(e).filter(ss),le=(e,t)=>ts(e||O(t)),is=(e,t)=>{rs(O(e)).forEach(r=>{S(r,e.class_error),H(r)}),t.update()},as=(e,t)=>{!C||(t._onlineHandler=()=>{is(e,t)},window.addEventListener("online",t._onlineHandler))},os=e=>{!C||window.removeEventListener("online",e._onlineHandler)},V=function(e,t){const s=we(e);this._settings=s,this.loadingCount=0,es(s,this),as(s,this),this.update(t)};V.prototype={update:function(e){const t=this._settings,s=le(e,t);if(_e(this,s.length),pe||!ue){this.loadAll(s);return}if(Ve(t)){qt(s,t,this);return}Zt(this._observer,s)},destroy:function(){this._observer&&this._observer.disconnect(),os(this),O(this._settings).forEach(e=>{Ie(e)}),delete this._observer,delete this._settings,delete this._onlineHandler,delete this.loadingCount,delete this.toLoadCount},loadAll:function(e){const t=this._settings;le(e,t).forEach(r=>{B(r,this),te(r,t,this)})},restoreAll:function(){const e=this._settings;O(e).forEach(t=>{Ft(t,e)})}};V.load=(e,t)=>{const s=we(t);te(e,s)};V.resetStatus=e=>{H(e)};C&&tt(V,window.lazyLoadOptions);class ns{constructor({namespace:t,pages$:s,sideEffect:r,readonly$:i,events:n,wrapClassName:c,root:l,pagesIndex$:d}){a(this,"namespace");a(this,"pages$");a(this,"sideEffect");a(this,"readonly$");a(this,"events");a(this,"wrapClassName");a(this,"showPreview$",new E(!1));a(this,"$preview");a(this,"$previewMask");a(this,"previewLazyLoad");this.namespace=t,this.pages$=s,this.sideEffect=r,this.readonly$=i,this.events=n,this.wrapClassName=c,this.sideEffect.addDisposer(this.events.on("togglePreview",()=>{this.showPreview$.setValue(!this.showPreview$.value)})),this.sideEffect.addDisposer(this.showPreview$.subscribe(o=>{this.sideEffect.add(()=>{const h=this.renderPreview(),u=this.renderPreviewMask();if(o){l.appendChild(h),l.appendChild(u),h.scrollTop;const g=h.querySelector("."+this.wrapClassName(`preview-page-${d.value}`));return g&&h.scrollTo({top:g.offsetTop-16}),h.classList.toggle(this.wrapClassName("preview-active"),!0),this.previewLazyLoad=new V({container:this.$preview,elements_selector:"."+this.wrapClassName("preview-page>img")}),()=>{var p;return(p=this.previewLazyLoad)==null?void 0:p.destroy()}}else return h.classList.toggle(this.wrapClassName("preview-active"),!1),this.sideEffect.setTimeout(()=>{h.remove(),u.remove()},500,"preview-remove"),null},"preview-lazyload")}))}destroy(){var t,s;(t=this.$preview)==null||t.remove(),(s=this.$previewMask)==null||s.remove()}renderPreview(){if(this.$preview)return this.$preview;const t=document.createElement("div");return t.className=this.wrapClassName("preview")+" tele-fancy-scrollbar",this.$preview=t,this.sideEffect.addEventListener(t,"wheel",s=>s.stopPropagation(),{passive:!1}),this.sideEffect.addDisposer(this.pages$.subscribe(s=>{var r;this.sideEffect.add(()=>{const i=s.map((n,c)=>{var g;const l=(g=n.thumbnail)!=null?g:n.src.startsWith("ppt")?void 0:n.src;if(!l)return;const d=String(c),o=document.createElement("a");o.className=this.wrapClassName("preview-page")+" "+this.wrapClassName(`preview-page-${c}`),o.setAttribute("href","#"),o.dataset.pageIndex=d;const h=document.createElement("span");h.className=this.wrapClassName("preview-page-name"),h.textContent=String(c+1),h.dataset.pageIndex=d;const u=document.createElement("img");return u.width=n.width,u.height=n.height,u.dataset.src=l,u.dataset.pageIndex=d,o.appendChild(u),o.appendChild(h),t.appendChild(o),o});return()=>i.forEach(n=>n==null?void 0:n.remove())},"render-preview-pages"),(r=this.previewLazyLoad)==null||r.update()})),this.sideEffect.addEventListener(t,"click",s=>{var i;if(this.readonly$.value)return;const r=(i=s.target.dataset)==null?void 0:i.pageIndex;r&&(s.preventDefault(),s.stopPropagation(),s.stopImmediatePropagation(),this.events.emit("jumpPage",Number(r)),this.showPreview$.setValue(!1))}),t}renderPreviewMask(){if(this.$previewMask)return this.$previewMask;const t=document.createElement("div");return t.className=this.wrapClassName("preview-mask"),this.$previewMask=t,this.sideEffect.addEventListener(t,"click",s=>{this.readonly$.value||s.target===t&&this.showPreview$.setValue(!1)}),t}}function cs(e){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg");s.setAttribute("class",`${e}-footer-icon-sidebar`),s.setAttribute("viewBox","0 0 64 64");const r=document.createElementNS(t,"path");return r.setAttribute("fill","currentColor"),r.setAttribute("d","M50 8H14c-3.309 0-6 2.691-6 6v36c0 3.309 2.691 6 6 6h36c3.309 0 6-2.691 6-6V14c0-3.309-2.691-6-6-6zM12 50V14c0-1.103.897-2 2-2h8v40h-8c-1.103 0-2-.897-2-2zm40 0c0 1.103-.897 2-2 2H26V12h24c1.103 0 2 .897 2 2z"),s.appendChild(r),s}function ls(e){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg");s.setAttribute("class",`${e}-footer-icon-arrow-left`),s.setAttribute("viewBox","0 0 500 500");const r=document.createElementNS(t,"path");return r.setAttribute("fill","currentColor"),r.setAttribute("d","M177.81 249.959L337.473 90.295c2.722-2.865 2.651-7.378-.143-10.1-2.793-2.65-7.163-2.65-9.956 0l-164.75 164.75c-2.793 2.793-2.793 7.306 0 10.1l164.75 164.75c2.865 2.722 7.378 2.65 10.099-.143 2.651-2.794 2.651-7.163 0-9.957L177.809 249.959z"),s.appendChild(r),s}function ds(e){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg");s.setAttribute("class",`${e}-footer-icon-arrow-right`),s.setAttribute("viewBox","0 0 500 500");const r=document.createElementNS(t,"path");return r.setAttribute("fill","currentColor"),r.setAttribute("d","M322.19 250.041L162.527 409.705c-2.722 2.865-2.651 7.378.143 10.1 2.793 2.65 7.163 2.65 9.956 0l164.75-164.75c2.793-2.793 2.793-7.306 0-10.1l-164.75-164.75c-2.865-2.722-7.378-2.65-10.099.143-2.651 2.794-2.651 7.163 0 9.957l159.664 159.736z"),s.appendChild(r),s}function hs(e){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg");s.setAttribute("class",`${e}-footer-icon-play`),s.setAttribute("viewBox","0 0 500 500");const r=document.createElementNS(t,"path");return r.setAttribute("fill","currentColor"),r.setAttribute("d","M418.158 257.419L174.663 413.33c-6.017 3.919-15.708 3.772-21.291-.29-2.791-2.018-4.295-4.483-4.295-7.084V94.109c0-5.65 6.883-10.289 15.271-10.289 4.298 0 8.391 1.307 11.181 3.332l242.629 155.484c6.016 3.917 6.451 10.292.649 14.491-.216.154-.432.154-.649.292zM170.621 391.288l223.116-141.301L170.71 107.753l-.089 283.535z"),s.appendChild(r),s}function ps(e){const t="http://www.w3.org/2000/svg",s=document.createElementNS(t,"svg");s.setAttribute("class",`${e}-footer-icon-pause`),s.setAttribute("viewBox","0 0 500 500");const r=document.createElementNS(t,"path");return r.setAttribute("fill","currentColor"),r.setAttribute("d","M312.491 78.261c0-6.159 4.893-11.213 11.04-11.213 6.158 0 11.211 5.054 11.211 11.213v343.478c0 6.159-5.053 11.213-11.211 11.213-6.147 0-11.04-5.054-11.04-11.213V78.261zM165.257 78.261c0-6.159 4.893-11.213 11.04-11.213 6.158 0 11.211 5.054 11.211 11.213v343.478c0 6.159-5.053 11.213-11.211 11.213-6.147 0-11.04-5.054-11.04-11.213V78.261z"),s.appendChild(r),s}class us{constructor({namespace:t,pages$:s,sideEffect:r,readonly$:i,events:n,playable:c,wrapClassName:l,pagesIndex$:d,root:o}){a(this,"namespace");a(this,"pages$");a(this,"sideEffect");a(this,"readonly$");a(this,"events");a(this,"playable");a(this,"wrapClassName");a(this,"pagesIndex$");a(this,"$footer");this.namespace=t,this.pages$=s,this.sideEffect=r,this.readonly$=i,this.events=n,this.wrapClassName=l,this.pagesIndex$=d,this.playable=c,this.$footer=this.render(),o.appendChild(this.$footer)}destroy(){this.$footer.remove()}render(){const t=document.createElement("div");t.className=this.wrapClassName("footer"),this.sideEffect.addDisposer(this.readonly$.subscribe(o=>t.classList.toggle(this.wrapClassName("readonly"),o)));const s=this.renderFooterBtn("btn-sidebar",cs(this.namespace));this.sideEffect.addEventListener(s,"click",()=>{this.readonly$.value||this.events.emit("togglePreview")}),t.appendChild(s),this.sideEffect.addDisposer(this.pages$.subscribe(o=>{const h=o.some(u=>u.thumbnail||!u.src.startsWith("ppt"));s.style.display=h?"":"none"}));const r=document.createElement("div");r.className=this.wrapClassName("page-jumps");const i=this.renderFooterBtn("btn-page-back",ls(this.namespace));if(this.sideEffect.addEventListener(i,"click",()=>{this.readonly$.value||this.events.emit("back")}),r.appendChild(i),this.playable){const o=this.renderFooterBtn("btn-page-play",hs(this.namespace),ps(this.namespace));this.sideEffect.addEventListener(o,"click",()=>{this.readonly$.value||(o.classList.toggle(this.wrapClassName("footer-btn-playing"),!0),this.events.emit("play"),this.sideEffect.setTimeout(()=>o.classList.toggle(this.wrapClassName("footer-btn-playing"),!1),500,"returnPlay"))}),r.appendChild(o)}const n=this.renderFooterBtn("btn-page-next",ds(this.namespace));this.sideEffect.addEventListener(n,"click",()=>{this.readonly$.value||this.events.emit("next")}),r.appendChild(n);const c=document.createElement("div");c.className=this.wrapClassName("page-number");const l=document.createElement("input");l.className=this.wrapClassName("page-number-input"),this.sideEffect.addDisposer(this.readonly$.subscribe(o=>l.disabled=o)),this.sideEffect.addDisposer(this.pagesIndex$.subscribe(o=>l.value=String(o+1))),this.sideEffect.addEventListener(l,"blur",()=>{l.value=String(this.pagesIndex$.value+1)}),this.sideEffect.addEventListener(l,"change",()=>{if(this.readonly$.value)return;const o=l.value?Number(l.value)-1:NaN;o>=0?this.events.emit("jumpPage",o):l.value=String(this.pagesIndex$.value+1)});const d=document.createElement("span");return this.sideEffect.addDisposer(this.pages$.subscribe(o=>{d.textContent=" / "+o.length})),c.appendChild(l),c.appendChild(d),t.appendChild(r),t.appendChild(c),t}renderFooterBtn(t,s,r){const i=document.createElement("button");return i.className=this.wrapClassName("footer-btn")+" "+this.wrapClassName(t),i.appendChild(s),r&&i.appendChild(r),i}}class He{constructor({readonly$:t,pagesIndex$:s,previewRoot:r,footerRoot:i,pages$:n,playable:c}){a(this,"preview");a(this,"footer");a(this,"wrapClassName",t=>`${this.namespace}-${t}`);a(this,"namespace","netless-app-docs-viewer");a(this,"sideEffect",new N);a(this,"events",new Ye);this.preview=new ns({pages$:n,readonly$:t,pagesIndex$:s,root:r,sideEffect:this.sideEffect,events:this.events,namespace:this.namespace,wrapClassName:this.wrapClassName}),this.footer=new us({pages$:n,readonly$:t,playable:c,pagesIndex$:s,root:i,namespace:this.namespace,sideEffect:this.sideEffect,events:this.events,wrapClassName:this.wrapClassName})}destroy(){this.preview.destroy(),this.footer.destroy(),this.sideEffect.flushAll(),this.events.destroy()}}function x(e,t,s){return Math.min(Math.max(e,t),s)}function de(e){return e.touches?e.touches[0]:e}function Be(e){e.stopPropagation(),e.cancelable&&e.preventDefault()}function Ue(e,t){return e.width===t.width&&e.height===t.height}class gs{constructor(t){a(this,"stiffness");a(this,"damping");a(this,"current");a(this,"target");a(this,"velocity",0);a(this,"onStep");a(this,"_paused",!0);a(this,"_animationFrameID",null);a(this,"_loopTimestamp",0);a(this,"looper",t=>{var r;if(this._paused)return;let s=Math.floor((t-this._loopTimestamp)/1e3*60)+1;for(this._loopTimestamp=t;s-- >0;)this.stepper();(r=this.onStep)==null||r.call(this,this.current),this._paused?this._animationFrameID=null:this._animationFrameID=window.requestAnimationFrame(this.looper)});var s,r,i;this.current=(s=t.start)!=null?s:0,this.target=this.current,this.stiffness=(r=t.stiffness)!=null?r:170,this.damping=(i=t.damping)!=null?i:26,this.onStep=t.onStep}get paused(){return this._paused}stepTo(t,s){var r;this._paused&&s!=null&&(this.current=s),this._paused=!1,this.target=t,(r=this.onStep)==null||r.call(this,this.current),this._loopTimestamp=Date.now(),this._animationFrameID=window.requestAnimationFrame(this.looper)}pause(){this._paused=!0,this._animationFrameID!=null&&window.cancelAnimationFrame(this._animationFrameID)}destroy(){this.pause(),this.onStep=void 0}stepper(){const t=-this.stiffness*(this.current-this.target),s=-this.damping*this.velocity,r=this.velocity+(t+s)/60,i=this.current+r/60;Math.abs(r-0)<.01&&Math.abs(i-this.target)<.01?(this.current=this.target,this.velocity=0,this._paused=!0):(this.current=i,this.velocity=r)}}class fs{constructor(t,s,r,i,n,c){a(this,"lastVisit",Date.now());a(this,"$page");a(this,"sideEffect",new N);this.index=t;const l=P(s,g=>g[t]||{width:0,height:0}),d=b([l,r],([g,p])=>(p.width-g.width)/2),o=b([n,c],([g,p])=>(g[t]||0)-p),h=document.createElement("div");h.className="page-renderer-page",h.dataset.index=`${t}`;const u=document.createElement("img");u.className="page-renderer-page-img",h.appendChild(u),this.sideEffect.addDisposer([b([l,i]).subscribe(([g,p])=>{h.style.width=`${g.width*p}px`,h.style.height=`${g.height*p}px`}),l.subscribe(g=>{g.thumbnail&&(h.style.backgroundImage=`url("${g.thumbnail}")`),u.width=g.width,u.height=g.height,u.src=g.src}),b([d,o,i]).subscribe(([g,p,f])=>{h.style.transform=`translate(${g*f}px, ${p*f}px)`})]),this.$page=h}destroy(){this.sideEffect.flushAll(),this.$page.remove()}}class ws{constructor(t,s,r,i,n){a(this,"els",new Map);a(this,"maxElCount",200);a(this,"gcTimer",null);a(this,"schedule");a(this,"cancelSchedule");a(this,"gc",()=>{var t;if(this.gcTimer=null,this.els.size>this.maxElCount){const s=[...this.els.values()].sort((r,i)=>i.lastVisit-r.lastVisit);for(let r=Math.floor(this.maxElCount/4);r<s.length;r++)(t=this.els.get(s[r].index))==null||t.destroy(),this.els.delete(s[r].index)}});this.pages$=t,this.pagesSize$=s,this.scale$=r,this.pagesYs$=i,this.pagesScrollTop$=n,this.schedule=window.requestIdleCallback||(c=>window.setTimeout(c,5e3)),this.cancelSchedule=window.cancelIdleCallback||window.clearTimeout}getEl(t){let s=this.els.get(t);return s||(s=new fs(t,this.pages$,this.pagesSize$,this.scale$,this.pagesYs$,this.pagesScrollTop$),this.els.set(t,s)),s.lastVisit=Date.now(),this.els.size>this.maxElCount&&this.gcTimer===null&&(this.gcTimer=this.schedule(this.gc)),s}destroy(){this.els.forEach(t=>t.destroy()),this.els.clear(),this.gcTimer!==null&&(this.cancelSchedule(this.gcTimer),this.gcTimer=null)}}class vs{constructor({pagesScrollTop$:t,containerRect$:s,pages$:r,pagesSize$:i}){a(this,"$pages");a(this,"sideEffect",new N);a(this,"pageElManager");r=P(r,p=>p.map(f=>{if(f.thumbnail)return f;try{const w=new URL(f.src);return w.searchParams.set("x-oss-process","image/resize,l_50"),{...f,thumbnail:w.toString()}}catch(w){return console.error(w),f}}));const n=P(r,p=>{const f=Array(p.length);for(let w=0;w<p.length;w++)f[w]=w>0?f[w-1]+p[w-1].height:0;return f}),c=P(r,p=>{let f=1/0;for(let w=p.length-1;w>=0;w--)p[w].height<=f&&(f=p[w].height);return f}),l=b([t,n,r],([p,f,w])=>{if(f.length!==w.length)return l.value;for(let m=0;m<f.length;m++)if(f[m]+w[m].height-p>=.001)return m;return f.length-1}),d=b([s,i],([p,f])=>p.width/f.width||1),o=b([r,s,c,d],([p,f,w,m])=>x(Math.ceil(f.height/m/w/2),1,p.length));je(this,{pagesScrollTop:t,containerRect:s,pages:r,pagesSize:i,pagesIndex:l,pagesYs:n,pagesMinHeight:c,scale:d}),this.pageElManager=new ws(r,i,d,n,t),this.$pages=this.renderPages();const h=new E(!1);this.sideEffect.addDisposer(h.subscribe(p=>this.$pages.classList.toggle("is-hwa",p)));const u=()=>h.setValue(!1),g=()=>{this.sideEffect.setTimeout(u,1e3,"turn-off-hwa"),h.setValue(!0)};this.sideEffect.addDisposer(b([l,o,r]).subscribe(([p,f,w])=>{g();const m=Math.max(p-f,0),se=Math.min(p+f,w.length-1);for(let y=0;y<this.$pages.children.length;y++){const D=this.$pages.children[y],re=Number(D.dataset.index);re>=m&&re<=se||(D.remove(),y--)}for(let y=m;y<=se;y++){const D=this.pageElManager.getEl(y);D.$page.parentElement!==this.$pages&&this.$pages.appendChild(D.$page)}}))}renderPages(){const t=document.createElement("div");return t.className="page-renderer-pages-container",this.sideEffect.addDisposer(this._containerRect$.subscribe(s=>{t.style.width=`${s.width}px`,t.style.height=`${s.height}px`}),"render-pages-size"),t}destroy(){this.sideEffect.flushAll(),this.$pages.remove(),this.pageElManager.destroy()}}const bs=30;class ms{constructor({pagesScrollTop$:t,containerRect$:s,stageRect$:r,pagesSize$:i,readonly$:n,scrollbarMinHeight:c=bs,wrapClassName:l,onDragScroll:d}){a(this,"sideEffect",new N);a(this,"scrollbarMinHeight");a(this,"readonly$");a(this,"wrapClassName");a(this,"onDragScroll");a(this,"$scrollbar");a(this,"pagesScrollTop$");a(this,"containerRect$");a(this,"stageRect$");a(this,"pagesSize$");a(this,"scrolling$",new E(!1));a(this,"scrollbarHeight$");a(this,"scrollTop$");this.pagesScrollTop$=t,this.containerRect$=s,this.stageRect$=r,this.pagesSize$=i,this.scrollbarMinHeight=c,this.readonly$=n,this.wrapClassName=l,this.onDragScroll=d,this.scrollbarHeight$=b([s,r,i],([o,h,u])=>x(h.height/(h.width/u.width*u.height)*o.height,c,o.height)),this.scrollTop$=b([s,r,i,this.scrollbarHeight$,this.pagesScrollTop$],([o,h,u,g,p])=>x(p/(u.height-u.width/h.width*h.height)*(o.height-g),0,o.height-g)),this.$scrollbar=this.renderScrollbar()}mount(t){t.appendChild(this.$scrollbar)}destroy(){this.$scrollbar.remove(),this.onDragScroll=void 0,this.sideEffect.flushAll()}renderScrollbar(){const t=document.createElement("button");t.className=this.wrapClassName("scrollbar"),t.style.minHeight=`${this.scrollbarMinHeight}px`,this.sideEffect.addDisposer([this.scrollbarHeight$.subscribe(r=>{t.style.height=`${r}px`}),this.scrollTop$.subscribe(r=>{this.scrolling$.setValue(!0),this.sideEffect.setTimeout(()=>this.scrolling$.setValue(!1),100,"reset-scrolling");const i=()=>t.style.transform=`translateY(${r}px)`;window.requestAnimationFrame?window.requestAnimationFrame(i):i()}),this.scrolling$.subscribe(r=>{t.classList.toggle(this.wrapClassName("scrolling"),r)})]);const s=r=>{if(!r.isPrimary||this.readonly$.value||r.button!=null&&r.button!==0)return;Be(r);const i=this.wrapClassName("scrollbar-dragging");t.classList.toggle(i,!0);const n=this.pagesScrollTop$.value,{clientY:c}=de(r),l=o=>{if(!o.isPrimary||this.readonly$.value)return;const{clientY:h}=de(o),u=h-c;Math.abs(u)>0&&this.onDragScroll&&this.onDragScroll(n+u/this.containerRect$.value.height*this.pagesSize$.value.height)},d=o=>{!o.isPrimary||(t.classList.toggle(i,!1),window.removeEventListener("pointermove",l,!0),window.removeEventListener("pointerup",d,!0),window.removeEventListener("pointercancel",d,!0))};window.addEventListener("pointermove",l,!0),window.addEventListener("pointerup",d,!0),window.addEventListener("pointercancel",d,!0)};return this.sideEffect.addEventListener(t,"pointerdown",s),t}}class Ss{constructor({whiteboard:t,readonly$:s,box:r,pages:i,pagesScrollTop:n=0,onUserScroll:c}){a(this,"readonly$");a(this,"pagesScrollTop$");a(this,"pagesSize$");a(this,"pageRenderer");a(this,"scrollbar");a(this,"sideEffect",new N);a(this,"pageScrollStepper");a(this,"userScrolling",!1);a(this,"pages");a(this,"box");a(this,"whiteboard");a(this,"onUserScroll");a(this,"debounceOnUserScroll");a(this,"viewer");this.whiteboard=t,this.readonly$=s,this.box=r,this.pages=i,this.onUserScroll=c;const l=()=>{var o;this.userScrolling=!1,(o=this.onUserScroll)==null||o.call(this,this.pagesScrollTop$.value)};this.debounceOnUserScroll=()=>{this.userScrolling=!0,this.sideEffect.setTimeout(l,80,"debounceOnUserScroll")};const d=new E(i);this.pagesScrollTop$=new E(n),this.pagesSize$=P(d,o=>{let h=0,u=0;for(let g=o.length-1;g>=0;g--){const p=o[g];p.width>h&&(h=p.width),u+=p.height}return{width:Math.max(1,h),height:Math.max(1,u)}},{compare:Ue}),this.pageRenderer=new vs({pagesScrollTop$:this.pagesScrollTop$,containerRect$:r._stageRect$,pages$:d,pagesSize$:this.pagesSize$}),this.viewer=new He({readonly$:s,pagesIndex$:this.pageRenderer._pagesIndex$,previewRoot:r.$body,footerRoot:r.$footer,pages$:d,playable:!1}),this.sideEffect.addDisposer([this.viewer.events.on("next",()=>{this.userScrollByPercent(.8)}),this.viewer.events.on("back",()=>{this.userScrollByPercent(-.8)})]),this.scrollbar=new ms({pagesScrollTop$:this.pagesScrollTop$,containerRect$:r._bodyRect$,stageRect$:r._stageRect$,pagesSize$:this.pagesSize$,readonly$:s,wrapClassName:this.wrapClassName.bind(this),onDragScroll:o=>{this.pageScrollTo(o),this.debounceOnUserScroll()}}),this.pageScrollStepper=new gs({start:this.pagesScrollTop$.value,onStep:o=>{this.pageScrollTo(o)}}),this.sideEffect.addDisposer(this.viewer.events.on("jumpPage",o=>this.userScrollToPageIndex(o))),this.render(),this.setupScrollListener(),this.sideEffect.setTimeout(()=>{this.userScrolling||this.pageScrollTo(this.pageRenderer.pagesScrollTop)},100)}get pagesScrollTop(){return this.pagesScrollTop$.value}destroy(){this.sideEffect.flushAll(),this.pageScrollStepper.destroy(),this.onUserScroll=void 0,this.viewer.destroy(),this.pageRenderer.destroy(),this.scrollbar.destroy()}syncPageScrollTop(t){!this.userScrolling&&t>=0&&Math.abs(this.pagesScrollTop$.value-t)>.01&&this.pageScrollStepper.stepTo(t,this.pagesScrollTop$.value)}render(){this.box.$content.style.overflow="hidden",this.box.mountStage(this.pageRenderer.$pages),this.scrollbar.mount(this.box.$body)}pageScrollTo(t){const s=this.whiteboard.view.size.height/2/this.pageRenderer.scale;this.whiteboard.view.moveCamera({centerY:x(t+s,s,this.pagesSize$.value.height-s),animationMode:"immediately"})}userScrollToPageIndex(t){var s;if(t=x(t,0,this.pages.length-1),!this.readonly$.value&&!Number.isNaN(t)){const r=this.pageRenderer.pagesYs[t];r>=0&&((s=this.onUserScroll)==null||s.call(this,r+5/this.pageRenderer.scale))}}userScrollByPercent(t){var s;this.readonly$.value||(s=this.onUserScroll)==null||s.call(this,x(this.pageRenderer.pagesScrollTop+this.pageRenderer.containerRect.height/this.pageRenderer.scale*x(t,-1,1),0,this.pageRenderer.pagesSize.height-this.pageRenderer.containerRect.height/this.pageRenderer.scale))}setupScrollListener(){this.sideEffect.addEventListener(this.box.$main,"wheel",t=>{Be(t),!this.readonly$.value&&this.pageScrollStepper.paused&&(this.pageScrollTo(this.pagesScrollTop+t.deltaY),this.debounceOnUserScroll())},{passive:!1}),this.sideEffect.addEventListener(this.box.$main,"touchmove",t=>{!this.readonly$.value&&t.touches.length>1&&this.debounceOnUserScroll()},{passive:!0,capture:!0}),this.sideEffect.add(()=>{const t=s=>{const{width:r,height:i}=this.whiteboard.view.size;if(r<=0||i<=0)return;const n=s.centerY-this.pageRenderer.containerRect.height/this.pageRenderer.scale/2;this.pagesScrollTop$.setValue(Math.max(0,n))};return this.whiteboard.view.callbacks.on("onCameraUpdated",t),()=>this.whiteboard.view.callbacks.off("onCameraUpdated",t)}),this.sideEffect.addDisposer(this.box._stageRect$.subscribe(t=>{const{width:s,height:r}=this.pagesSize$.value;this.whiteboard.view.moveCameraToContain({originX:0,originY:this.pageRenderer.pagesScrollTop,width:s,height:t.height/this.pageRenderer.scale,animationMode:"immediately"}),this.whiteboard.view.setCameraBound({damping:1,maxContentMode:()=>this.pageRenderer.scale,minContentMode:()=>this.pageRenderer.scale,centerX:s/2,centerY:r/2,width:s,height:r})}),"whiteboard-size-update"),this.sideEffect.addEventListener(window,"keyup",t=>{if(!(this.readonly$.value||!this.box.focus||this.box.minimized))switch(t.key){case"PageDown":{this.userScrollByPercent(.8);break}case"PageUp":{this.userScrollByPercent(-.8);break}case"ArrowLeft":{this.userScrollByPercent(-.25);break}case"ArrowRight":{this.userScrollByPercent(.25);break}case"ArrowDown":{this.userScrollByPercent(.5);break}case"ArrowUp":{this.userScrollByPercent(-.5);break}}},{capture:!0})}wrapClassName(t){return"netless-app-docs-viewer-static-"+t}}class Es{constructor({readonly$:t,context:s,whiteboard:r,box:i,pages:n}){a(this,"pagesIndex$");a(this,"sideEffect",new N);a(this,"context");a(this,"pages");a(this,"box");a(this,"whiteboard");a(this,"viewer");this.context=s,this.whiteboard=r,this.box=i,this.pages=n;const c=new E(s.displayer.state.sceneState.index||0);this.pagesIndex$=c,this.sideEffect.add(()=>{const l=d=>{this.jumpToPage(d.index)};return this.context.emitter.on("sceneStateChange",l),()=>this.context.emitter.off("sceneStateChange",l)}),this.viewer=new He({readonly$:t,pagesIndex$:c,previewRoot:i.$body,footerRoot:i.$footer,pages$:new E(n),playable:!0}),this.sideEffect.addDisposer([this.viewer.events.on("jumpPage",l=>this.jumpToPage(l,!0)),this.viewer.events.on("play",()=>{var l;return(l=this.context.room)==null?void 0:l.pptNextStep()}),this.viewer.events.on("back",()=>this.prevPage()),this.viewer.events.on("next",()=>this.nextPage())]),this.render(),this.sideEffect.addDisposer(c.subscribe((l,d)=>{var u,g;if(t.value)return;const o=this.context.getInitScenePath(),h=(g=(u=this.context.getScenes())==null?void 0:u[l])==null?void 0:g.name;if(o&&h&&this.context.setScenePath(`${o}/${h}`),d){const p=this.context.room;if(p){const f=p.state.globalState.__pptState;p.setGlobalState({__pptState:f&&{uuid:f.uuid,pageIndex:l,disableAutoPlay:f.disableAutoPlay}})}}}))}destroy(){this.sideEffect.flushAll(),this.viewer.destroy()}nextPage(){this.jumpToPage(this.pagesIndex$.value+1,!0)}prevPage(){this.jumpToPage(this.pagesIndex$.value-1,!0)}jumpToPage(t,s=!1){this.pagesIndex$.setValue(x(t,0,this.pages.length-1),s)}render(){var s;this.box.mountStage(document.createElement("div")),this.sideEffect.addEventListener(window,"keydown",r=>{var i;if(this.box.focus)switch(r.key){case"ArrowUp":case"ArrowLeft":{this.prevPage();break}case"ArrowRight":case"ArrowDown":{(i=this.context.room)==null||i.pptNextStep();break}}});const t=(s=this.whiteboard.view.divElement)==null?void 0:s.parentElement;t&&this.sideEffect.addEventListener(t,"click",r=>{var n;const i=this.context.room;if(i&&i.state.memberState.currentApplianceName==="clicker"){for(let c=r.target;c;c=c.parentElement)if((n=c.classList)!=null&&n.contains("ppt-event-source"))return;i.pptNextStep()}})}wrapClassName(t){return"netless-app-docs-viewer-dynamic-"+t}}const ks={kind:Ge,setup(e){const t=e.box,s=e.getScenes();if(!s)throw new Error("[Docs Viewer]: scenes not found.");const r=new N,i=s.map(({ppt:c})=>c?{width:c.width,height:c.height,src:c.src,thumbnail:c.previewURL}:null).filter(c=>Boolean(c));if(i.length<=0)throw new Error("[Docs Viewer]: empty scenes.");t.mountStyles(qe);const n=new E(!e.isWritable);r.addDisposer(e.emitter.on("writableChange",c=>{n.setValue(!c)})),i[0].src.startsWith("ppt")?ys(r,e,t,i,n):$s(r,e,t,i,n),r.addDisposer(e.emitter.on("destroy",()=>{r.flushAll()}))}};function $s(e,t,s,r,i){const n=t.createWhiteBoardView({syncCamera:!1});e.addDisposer(i.subscribe(d=>{n.view.disableCameraTransform=d}));const c=t.createStorage("static-docs-viewer",{pagesScrollTop:0}),l=new Ss({whiteboard:n,readonly$:i,box:s,pages:r,pagesScrollTop:c.state.pagesScrollTop,onUserScroll:d=>{t.isWritable&&c.setState({pagesScrollTop:d})}});e.addDisposer(()=>l.destroy()),e.addDisposer(c.on("stateChanged",d=>{d.pagesScrollTop&&l.syncPageScrollTop(d.pagesScrollTop.newValue||0)})),e.addDisposer(b([s._maximized$,s._managerStageRect$,s._intrinsicSize$,l.pagesSize$,l.pageRenderer._pagesMinHeight$],([d,o,h,u,g])=>d?Math.max(g/u.width*(2/5),o.height/o.width):h.height/h.width*(o.height/o.width)).subscribe(d=>{s.setStageRatio(d)}))}function ys(e,t,s,r,i){const n=t.createWhiteBoardView();n.view.disableCameraTransform=!0;const c=new Es({context:t,whiteboard:n,box:s,pages:r,readonly$:i});e.addDisposer(()=>c.destroy());const l=new E({width:r[0].width,height:r[0].height},{compare:Ue});if(e.addDisposer(c.pagesIndex$.subscribe(d=>{const o=r[d];o&&l.setValue({width:o.width,height:o.height})})),e.addDisposer(l.subscribe(d=>{i.value||n.setBaseRect(d)})),t.isAddApp){const d=e.add(()=>{const o=({width:h,height:u})=>{if(r.length>0&&s.state!=="maximized"){const{width:g,height:p}=r[0],w=p/g*h-u;w!==0&&t.isWritable&&t.emitter.emit("setBoxSize",{width:s.intrinsicWidth,height:s.intrinsicHeight+w/s.rootRect.height})}e.remove(d)};return n.view.callbacks.once("onSizeUpdated",o),()=>n.view.callbacks.off("onSizeUpdated",o)})}}export{He as DocsViewer,ks as NetlessAppDocsViewer,vs as PageRenderer,ms as ScrollBar,gs as Stepper,ks as default};
